(function(){window.app.controller("AdminController",["$scope","$http",function(a,b){return a.migrate=function(){var c;return c=b.get("http://astrojason.herokuapp.com/api/links"),c.success(function(b){var c;return c="",angular.forEach(b.links,function(b){var d;return c+="Link::create(array('name' => \""+a.stripChars(b.name)+"\", 'link' => \""+b.link+"\", 'is_read' => "+(null!=(d=b.read)?d:{1:0})+", 'category' => \""+b.category+"\", 'user_id' => 1",b.instapaper_id&&(c+=", 'instapaper_id' => "+b.instapaper_id),c+="));\n"}),a.importSql=c}),c.error(function(){return a.$emit("errorOccurred","Problem loading links to migrate")})},a.stripChars=function(a){var b;return b=[['"',""],[";",":"]],angular.forEach(b,function(b){var c;for(c=[];a.indexOf(b[0])>=0;)c.push(a=a.replace(b[0],b[1]));return c}),a}}])}).call(this),function(){window.app.controller("BookController",["$scope","$controller","$timeout","$filter","Book",function(a,b,c,d,Book){return b("FormMasterController",{$scope:a}),a.loading_books=!1,a.$on("bookDeleted",function(b,c){return a.books=d("filter")(a.books,{id:"!"+c}),a.book_results=d("filter")(a.book_results,{id:"!"+c})}),a.triggerRecommender=function(){return a.$watch("recommendingBook",function(b){return b?a.getRecommendation():void 0})},a.initList=function(){return a.$watch("filter_category",function(){return a.loading_books?void 0:a.get()}),a.$watch("book_query",function(){return a.loading_books?void 0:(a.searching=!0,c.cancel(a.search_timeout),a.search_timeout=c(function(){return a.get()},500))}),a.$watch("is_read",function(){return a.loading_books?void 0:a.get()}),a.$watch("sort",function(){return a.loading_books?void 0:a.get()})},a.get=function(){var b;return a.loading_books=!0,b=[],a.book_query&&(b.q=a.book_query),a.is_read&&(b.include_read=a.is_read),a.filter_category&&(b.category=a.filter_category),a.sort&&(b.sort=a.sort),Book.query(b,function(b){return a.books=b.books,a.loading_books=!1})},a.save=function(){var b,c,d;return"New"===a.book.category&&(a.book.category=a.new_category),d=function(){return alertify.success("Book "+(a.book.id?"updated":"added")+" successfully"),a.book.id?a.editing=!1:a.$emit("closeModal")},c=function(b){return a.errorMessage=b.data.error},b=Book.save($.param(a.book)),b.$promise.then(d,c)},a.toggleRead=function(){return a.book.is_read=!a.book.is_read,a.save()},a["delete"]=function(){var b,c,d;return d=function(){return alertify.success("Book deleted successfully"),a.deleting=!1,a.editing=!1,a.$emit("bookDeleted",a.book.id)},b=function(b){return a.errorMessage=b.data.error},c=Book.remove({id:a.book.id}),c.$promise.then(d,b)},a.getRecommendation=function(){var b,c,d;return a.recommendation_category?(d=function(b){return a.book=b.book},c=function(){return console.log("Something went wrong")},b=Book.recommend({category:a.recommendation_category}),b.$promise.then(d,c)):void 0},a.setCategories=function(b){return a.categories=b,(null!=b?b.length:void 0)>0?a.recommendation_category=b[0]:void 0},a.checkEditing=function(){var b;return null!=(b=a.book)?b.id:void 0}}])}.call(this),function(){window.app.controller("DashboardController",["$scope","$http","$location","$timeout","$filter","UserService","Link",function(a,b,c,d,e,f,Link){return a.display_category=c.search().category||"",a.search_timeout=null,a.daily_links=[],a.selected_links=[],a.link_results=[],a.loading_unread=!1,a.recommendingBook=!1,a.recommendingGame=!1,a.recommendingSong=!1,a.linkModalOpen=!1,a.bookModalOpen=!1,a.movieModalOpen=!1,a.gameModalOpen=!1,a.songModalOpen=!1,a.$on("userLoggedIn",function(){return a.initDashboard()}),a.$on("userLoggedOut",function(){return a.initDashboard()}),a.$on("linkDeleted",function(b,c){return a.daily_links=e("filter")(a.daily_links,{id:"!"+c}),a.unread_links=e("filter")(a.unread_links,{id:"!"+c}),a.selected_links=e("filter")(a.selected_links,{id:"!"+c}),a.link_results=e("filter")(a.link_results,{id:"!"+c})}),a.$on("linkUpdated",function(){return a.daily_links=e("filter")(a.daily_links,{category:"Daily",is_read:!1}),a.unread_links=e("filter")(a.unread_links,{category:"Unread",is_read:!1}),a.selected_links=e("filter")(a.selected_links,{category:a.display_category,is_read:!1})}),a.$on("closeModal",function(){return a.linkModalOpen=!1,a.bookModalOpen=!1,a.movieModalOpen=!1,a.gameModalOpen=!1,a.songModalOpen=!1}),a.$watch("display_category",function(b){return""!==b?a.getCategoryArticles():void 0}),a.$watch("article_search",function(b){return a.searching=!0,d.cancel(a.search_timeout),(null!=b?b.length:void 0)>=3?a.search_timeout=d(function(){return a.search_articles()},500):void 0}),a.$watch("is_read",function(){var b;return d.cancel(a.search_timeout),(null!=(b=a.article_search)?b.length:void 0)>=3?a.search_timeout=d(function(){return a.search_articles()},500):void 0}),a.$watch("linkModalOpen",function(){return a.linkModalOpen?void 0:a.newLink=new window.Link}),a.$watch("bookModalOpen",function(){return a.bookModalOpen?void 0:a.newBook=new window.Book}),a.$watch("movieModalOpen",function(){return a.movieModalOpen?void 0:a.newMovie=new window.Movie}),a.$watch("gameModalOpen",function(){return a.gameModalOpen?void 0:a.newGame=new window.Game}),a.$watch("songModalOpen",function(){return a.songModalOpen?void 0:a.newSong=new window.Song}),a.getCategoryArticles=function(){var b;return a.selected_links=[],a.loading_category=!0,b={category:a.display_category,limit:10,randomize:!0},Link.query(b,function(b){return a.selected_links=b.links,a.loading_category=!1})},a.search_articles=function(){var b;return a.searching=!0,a.link_results=[],b={q:a.article_search},a.is_read&&(b.include_read=!0),Link.query(b,function(b){return a.link_results=b.links,a.searching=!1})},a.initDashboard=function(){var b;return a.user=f.getUser(),(null!=(b=a.user)?b.id:void 0)?a.loadDashboard():void 0},a.loadDashboard=function(){var c;return c=b.get("/api/dashboard"),c.success(function(b){return b.success?(a.total_read=b.total_read,a.categories=b.categories,a.total_links=b.total_links,a.links_read=b.links_read,a.total_books=b.total_books,a.books_read=b.books_read,a.books_toread=b.books_toread,a.games_toplay=b.games_toplay,a.songs_toplay=b.songs_toplay):a.$emit("errorOccurred",b.error)}),c.error(function(){return a.$emit("errorOccurred","Problem loading daily results")}),Link.query({category:"Daily"},function(b){return a.daily_links=b.links}),a.refreshUnreadArticles()},a.refreshUnreadArticles=function(){var b;return a.unread_links=[],a.loading_unread=!0,b={category:"Unread",limit:20,randomize:!0},Link.query(b,function(b){return a.unread_links=b.links,a.loading_unread=!1})},a.populateLinks=function(){var c;return c=b.get("/api/links/populate"),c.success(function(b){return b.success?a.loadDashboard():void 0})},a.initDashboard()}])}.call(this),function(){window.app.controller("FormMasterController",["$scope","$location",function(a,b){return a.searching=!1,a.updating=!1,a.search_timeout=null,a.limit=b.search().limit||20,a.page=parseInt(b.search().page||1),a.cancelEdit=function(){return a.updating?a.editing=!1:a.$emit("closeModal")},a.$watch("editing",function(b){return b&&a.checkEditing?a.updating=a.checkEditing():void 0}),a.generatePages=function(){var b,c,d;return a.nav_pages=[],a.pages>1?(c=a.page>=5?a.page-4:1,b=c+10,b>a.pages&&(b=a.pages),a.nav_pages=function(){d=[];for(var a=c;b>=c?b>a:a>b;b>=c?a++:a--)d.push(a);return d}.apply(this)):void 0}}])}.call(this),function(){window.app.controller("GameController",["$scope","$filter","$controller","$timeout","Game",function(a,b,c,d,Game){return c("FormMasterController",{$scope:a}),a.$on("gameDeleted",function(c,d){return a.games=b("filter")(a.games,{id:"!"+d}),a.game_results=b("filter")(a.game_results,{id:"!"+d})}),a.$watch("game_query",function(b){return d.cancel(a.search_timeout),(null!=b?b.length:void 0)>=3?a.search_timeout=d(function(){return a.search_games()},500):void 0}),a.triggerRecommender=function(){return a.$watch("recommendingGame",function(b){return b?a.getRecommendation():void 0})},a.all=function(){return a.loading_games=!0,Game.query(function(b){return a.games=b.games,a.loading_games=!1})},a.search_games=function(){var b;return a.searching_games=!0,b={q:a.game_query},Game.query(b,function(b){return a.game_results=b.games,a.searching_games=!1})},a.save=function(){var b,c,d;return"New"===a.game.category&&(a.game.category=a.new_category),d=function(){return alertify.success("Game "+(a.game.id?"updated":"added")+" successfully"),a.game.id?a.editing=!1:a.$emit("closeModal")},b=function(){return a.errorMessage=response.data.error},c=Game.save($.param(a.game)),c.$promise.then(d,b)},a.togglePlayed=function(){return a.game.played=!a.game.played,a.save()},a["delete"]=function(){var b,c,d;return d=function(){return alertify.success("Game deleted successfully"),a.deleting=!1,a.editing=!1,a.$emit("gameDeleted",a.game.id)},b=function(b){return a.errorMessage=b.data.error},c=Game.remove({id:a.game.id}),c.$promise.then(d,b)},a.setPlatforms=function(b){return a.platforms=b},a.checkEditing=function(){var b;return null!=(b=a.game)?b.id:void 0},a.getRecommendation=function(){var b,c,d;return d=function(b){return a.game=b.game},b=function(){return console.log("Something went wrong")},c=Game.recommend(),c.$promise.then(d,b)}}])}.call(this),function(){window.app.controller("LinkController",["$scope","$controller","$filter","$timeout","$location","Link",function(a,b,c,d,e,Link){return b("FormMasterController",{$scope:a}),a.deleting=!1,a.errorMessage=!1,a.$on("linkDeleted",function(b,d){return a.links=c("filter")(a.links,{id:"!"+d}),a.link_results=c("filter")(a.link_results,{id:"!"+d})}),a.$watch("link.link",function(b,c){return b!==c?a.errorMessage=!1:void 0}),a.initList=function(){return a.query(),a.$watch("links_query",function(){return a.loading_links||(d.cancel(a.search_timeout),a.loading_links)?void 0:a.search_timeout=d(function(){return a.query()},500)}),a.$watch("page",function(b,c){var d;return a.loading_links||b===c?void 0:(d=e.search(),d.page=b,e.search(d),a.query())}),a.$watch("display_category",function(){return a.loading_links?void 0:a.query()})},a.query=function(){var b;return a.loading_links=!0,b={limit:a.limit,page:a.page},a.links_query&&(b.q=a.links_query),a.display_category&&(b.category=a.display_category),Link.query(b,function(b){return a.loading_links=!1,a.links=b.links,a.total=b.total,a.pages=b.pages,a.generatePages()})},a.linkOpened=function(){return a.link.times_read+=1,a.save()},a.toggleRead=function(){return a.link.is_read=!a.link.is_read,a.save()},a["delete"]=function(){var b,c,d;return d=function(){return alertify.success("Link deleted successfully"),a.deleting=!1,a.editing=!1,a.$emit("linkDeleted",a.link.id)},b=function(b){return a.errorMessage=b.data.error},c=Link.remove({id:a.link.id}),c.$promise.then(d,b)},a.save=function(){var b,c,d;return"New"===a.link.category&&(a.link.category=a.new_category),d=function(){return alertify.success("Link "+(a.link.id?"updated":"added")+" successfully"),a.link.id?(a.editing=!1,a.$emit("linkUpdated",a.link)):a.$emit("closeModal")},b=function(b){return a.errorMessage=b.error},c=Link.save($.param(a.link)),c.$promise.then(d,b)},a.setCategories=function(b){return a.categories=b}}])}.call(this),function(){window.app.controller("MasterController",["$scope","$http","UserService",function(a,b,c){return a.initItems=0,a.$on("initStarted",function(){return a.init=!0,a.initItems++}),a.$on("initComplete",function(){return a.initItems--,0===a.initItems?a.init=!1:void 0}),a.$on("errorOccurred",function(b,c){return a.show_error=!0,a.error_message=c}),a.login=function(){var d,e;return a.init=!0,d={username:a.username,password:a.password},e=b.post("/api/login",$.param(d)),e.success(function(b){return a.init=!1,a.user=b.user,c.setUser(a.user),a.$broadcast("userLoggedIn")}),e.error(function(){return a.$emit("errorOccurred","Problem logging in")})},a.logout=function(){var d;return a.init=!0,d=b.post("/api/logout"),d.success(function(){return a.init=!1,a.user=null,c.setUser(a.user),a.$broadcast("userLoggedOut")}),d.error(function(){return a.$emit("errorOccurred","Problem logging out")})},a.initUser=function(b){return a.user=b,c.setUser(a.user)}}])}.call(this),function(){window.app.controller("MovieController",["$scope","$controller","$timeout","$filter","Movie",function(a,b,c,d,Movie){return b("FormMasterController",{$scope:a}),a.$on("movieDeleted",function(b,c){return a.movies=d("filter")(a.movies,{id:"!"+c}),a.movie_results=d("filter")(a.movie_results,{id:"!"+c})}),a.$on("dateChanged",function(b,c){return a.movie?a.movie.date_watched=c:void 0}),a.$watch("movie_query",function(b){return c.cancel(a.search_timeout),(null!=b?b.length:void 0)>=3?a.search_timeout=c(function(){return a.search_movies()},500):void 0}),a.toggleWatched=function(){return a.movie.is_watched=!a.movie.is_watched,a.save(a.movie)},a.save=function(b){var c,d,e;return e=function(){return alertify.success("Movie "+(b.id?"updated":"added")+" successfully"),a.movie.id?a.editing=!1:a.$emit("closeModal")},c=function(b){return a.errorMessage=b.data.error},d=Movie.save($.param(b)),d.$promise.then(e,c)},a["delete"]=function(){var b,c,d;return d=function(){return alertify.success("Movie deleted successfully"),a.deleting=!1,a.editing=!1,a.$emit("movieDeleted",a.movie.id)},b=function(b){return a.errorMessage=b.data.error},c=Movie.remove({id:a.movie.id}),c.$promise.then(d,b)},a.all=function(){return a.loading_movies=!0,Movie.query(function(b){return a.movies=b.movies,a.loading_movies=!1})},a.search_movies=function(){var b;return a.searching_movies=!0,b={q:a.movie_query},Movie.query(b,function(b){return a.movie_results=b.movies,a.searching_movies=!1})},a.checkEditing=function(){var b;return null!=(b=a.movie)?b.id:void 0}}])}.call(this),function(){window.app.controller("ReadLaterController",["$scope","$timeout",function(a,b){return a.newLink=null,a.success=!1,a.editing=!0,a.error=!1,a.createLink=function(b,c,d){return a.newLink=new window.Link(b),a.newLink.name=c,a.newLink.link=d},a.$on("closeModal",function(){return console.log("Closing modal"),b(function(){return window.parent.postMessage("closeWindow","*")},1e3)}),a.saveError=function(b){return a.error=b,a.editing=!1}}])}.call(this),function(){window.app.controller("SongController",["$scope","$timeout","$controller","$filter","Song",function(a,b,c,d,Song){return c("FormMasterController",{$scope:a}),a.$on("songDeleted",function(b,c){return a.songs=d("filter")(a.songs,{id:"!"+c}),a.song_results=d("filter")(a.song_results,{id:"!"+c})}),a.$watch("[song.title, song.artist]",function(){return a.errorMessage=""}),a.$watch("song_query",function(c){return b.cancel(a.search_timeout),(null!=c?c.length:void 0)>=3?a.search_timeout=b(function(){return a.search_songs()},500):void 0}),a.triggerRecommender=function(){return a.$watch("recommendingSong",function(b){return b?a.getRecommendation():void 0})},a.all=function(){return a.loading_songs=!0,Song.query(function(b){return a.songs=b.songs,a.loading_songs=!1})},a.save=function(){var b,c,d;return d=function(){return alertify.success("Song "+(a.song.id?"updated":"added")+" successfully"),a.song.id?a.editing=!1:a.$emit("closeModal")},b=function(b){return a.errorMessage=b.data.error},c=Song.save($.param(a.song)),c.$promise.then(d,b)},a.toggleLearned=function(){return a.song.learned=!a.song.learned,a.save()},a["delete"]=function(){var b,c,d;return d=function(){return alertify.success("Song deleted successfully"),a.deleting=!1,a.editing=!1,a.$emit("songDeleted",a.song.id)},b=function(b){return a.errorMessage=b.data.error},c=Song.remove({id:a.song.id}),c.$promise.then(d,b)},a.search_songs=function(){var b;return a.searching_songs=!0,b={q:a.song_query},Song.query(b,function(b){return a.song_results=b.songs,a.searching_songs=!1})},a.getRecommendation=function(){var b;return b={randomize:!0,limit:1},Song.query(b,function(b){return a.song=b.songs[0],a.loading_songs=!1})}}])}.call(this),function(){window.app.controller("UserController",["$scope","$http",function(a,b){return a.$on("checkingAvailability",function(){return a.submitting=!0}),a.$on("checkedAvailability",function(){return a.submitting=!1}),a.registerUser=function(){var c,d;return c={first_name:a.first_name,last_name:a.last_name,email:a.email,username:a.username,password:a.password},a.submitting=!0,d=b.post("/api/register",$.param(c)),d.success(function(a){return console.log(a)}),d.error(function(){return a.$emit("errorOccurred","Problem with registration")})}}])}.call(this);