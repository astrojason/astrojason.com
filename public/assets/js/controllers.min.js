(function(){window.app.controller("AdminController",["$scope","$http",function(a,b){return a.migrate=function(){var c;return c=b.get("http://astrojason.herokuapp.com/api/links"),c.success(function(b){var c;return c="",angular.forEach(b.links,function(b){var d;return c+="Link::create(array('name' => \""+a.stripChars(b.name)+"\", 'link' => \""+b.link+"\", 'is_read' => "+(null!=(d=b.read)?d:{1:0})+", 'category' => \""+b.category+"\", 'user_id' => 1",b.instapaper_id&&(c+=", 'instapaper_id' => "+b.instapaper_id),c+="));\n"}),a.importSql=c}),c.error(function(){return a.$emit("errorOccurred","Problem loading links to migrate")})},a.stripChars=function(a){var b;return b=[['"',""],[";",":"]],angular.forEach(b,function(b){var c;for(c=[];a.indexOf(b[0])>=0;)c.push(a=a.replace(b[0],b[1]));return c}),a}}])}).call(this),function(){window.app.controller("BookController",["$scope","$http","$timeout",function(a,b,c){return a.setCategories=function(b){return a.categories=b,b.length>0?a.recommendation_category=b[0]:void 0},a.getRecommendation=function(){var c;return a.getting_recomendation=!0,c=b.get("/api/books/recommendation/"+a.recommendation_category),c.success(function(b){return a.book=b.book}),c["finally"](function(){return a.getting_recomendation=!1})},a.markAsRead=function(){var c;return c=b.post("/api/books/read/"+a.book.id),c.success(function(){return response.success?a.book.is_read=!0:void 0})},a.markAsUnread=function(){var c;return c=b.post("/api/books/unread/"+a.book.id),c.success(function(){return response.success?a.book.is_read=!0:void 0})},a["delete"]=function(){return console.log("Delete called")},a.save=function(){var c,d;return d=a.book,"New"===a.book.category&&(a.book.category=a.new_category),c=b.post("/api/books/save",$.param(d)),c.success(function(b){return b.success?(a.book_form.category.$dirty&&a.$parent.changeBookCategory&&a.$parent.changeBookCategory(a.book),a.book.category===a.new_category&&a.categories.push(a.new_category),a.editing=!1,a.$parent.bookAdded&&a.$parent.bookAdded(),alertify.success("Book "+(0===parseInt(a.book.id)?"added":"updated")+" successfully")):(a.errorMessage=b.error,a.$parent.saveError?a.$parent.saveError(b.error):void 0)}),c.error(function(){var b;return a.$emit("errorOccurred","Problem "+(null!=(b=a.book.id)?b:{updating:"adding"})+" link")})},a.cancelEdit=function(){return console.log("Cancel edit called")},a.$watch("search_query",function(b){return a.searching=!0,c.cancel(a.search_timeout),(null!=b?b.length:void 0)>=3?a.search_timeout=c(function(){return a.search_books()},500):void 0}),a.search_books=function(){var c,d;return c={q:a.search_query},d=b.post("/api/books/search",$.param(c)),d.success(function(b){return a.search_results=b.books})}}])}.call(this),function(){window.app.controller("DashboardController",["$scope","$http","$location","$timeout","UserService",function(a,b,c,d,e){return a.display_category=c.search().category||"",a.search_timeout=null,a.daily_links=[],a.selected_links=[],a.search_results=[],a.addingLink=!1,a.loading_unread=!1,a.$on("userLoggedIn",function(){return a.initDashboard()}),a.$on("userLoggedOut",function(){return a.initDashboard()}),a.$watch("display_category",function(b){return""!==b?a.getCategoryArticles():void 0}),a.$watch("search_query",function(b){return a.searching=!0,d.cancel(a.search_timeout),(null!=b?b.length:void 0)>=3?a.search_timeout=d(function(){return a.search_articles()},500):void 0}),a.$watch("is_read",function(){var b;return d.cancel(a.search_timeout),(null!=(b=a.search_query)?b.length:void 0)>=3?a.search_timeout=d(function(){return a.search_articles()},500):void 0}),a.getCategoryArticles=function(){var c;return a.loading_category=!0,c=b.get("/api/links/dashboard/"+a.display_category),c.success(function(b){return b.success?a.selected_links=b.links:a.$emit("errorOccurred",b.error)}),c.error(function(){return a.$emit("errorOccurred","Problem loading category results")}),c["finally"](function(){return a.loading_category=!1})},a.search_articles=function(){var c,d;return a.loading_search=!0,a.search_results=[],c={q:a.search_query},a.is_read&&(c.include_read=!0),d=b.post("/api/links/search",$.param(c)),d.success(function(b){return b.success?(a.searching=!1,a.search_results=b.links):a.$emit("errorOccurred",b.error)}),d.error(function(){return a.$emit("errorOccurred","Problem loading search results")}),d["finally"](function(){return a.loading_search=!1})},a.deleteItem=function(b){var c;return c=a.daily_links.indexOf(b),c>=0&&a.daily_links.splice(c,1),c=a.unread_links.indexOf(b),c>=0&&a.unread_links.splice(c,1),c=a.selected_links.indexOf(b),c>=0&&a.selected_links.splice(c,1),c=a.search_results.indexOf(b),c>=0?a.search_results.splice(c,1):void 0},a.changeCategory=function(b){var c;return c=a.daily_links.indexOf(b),c>=0&&a.daily_links.splice(c,1),c=a.unread_links.indexOf(b),c>=0&&a.unread_links.splice(c,1),c=a.selected_links.indexOf(b),c>=0?a.selected_links.splice(c,1):void 0},a.markAsRead=function(b){var c;return a.total_read++,c=a.daily_links.indexOf(b),c>=0&&a.daily_links.splice(c,1),c=a.unread_links.indexOf(b),c>=0&&a.unread_links.splice(c,1),c=a.selected_links.indexOf(b),c>=0&&a.selected_links.splice(c,1),c=a.unread_links.indexOf(b),c>=0?a.unread_links.splice(c,1):void 0},a.addLink=function(){return a.addingLink=!0},a.linkAdded=function(){return a.addingLink=!1,a.newLink=window.Link(a.$parent.user.id)},a.bookAdded=function(){return a.addingBook=!1},a.initDashboard=function(){var b;return a.user=e.getUser(),(null!=(b=a.user)?b.id:void 0)?a.loadDashboard():void 0},a.loadDashboard=function(){var c;return a.newLink=window.Link(a.user.id),c=b.get("/api/dashboard"),c.success(function(b){return b.success?(a.daily_links=b.links,a.unread_links=b.unread,a.total_read=parseInt(b.total_read),a.categories=b.categories,a.total_links=b.total_links,a.links_read=b.links_read,a.total_books=b.total_books,a.books_read=b.books_read):a.$emit("errorOccurred",b.error)}),c.error(function(){return a.$emit("errorOccurred","Problem loading daily results")})},a.refreshUnreadArticles=function(){var c;return a.loading_unread=!0,c=b.get("/api/links/dashboard/unread/20"),c.success(function(b){return b.success?a.unread_links=b.links:a.$emit("errorOccurred",b.error)}),c.error(function(){return a.$emit("errorOccurred","Problem loading unread results")}),c["finally"](function(){return a.loading_unread=!1})},a.initDashboard()}])}.call(this),function(){window.app.controller("LinkController",["$scope","$http",function(a,b){return a.deleting=!1,a.errorMessage=!1,a.$watch("link.link",function(b,c){return b!==c?a.errorMessage=!1:void 0}),a.linkOpened=function(){var c;return c=b.post("/api/links/open/"+a.link.id),c.success(function(a){return console.log(a.success?"Read count updated":"Read count update problem")}),c.error(function(){return a.$emit("errorOccurred","Problem updating read count")})},a.markAsRead=function(){var c;return c=b.post("/api/links/read/"+a.link.id),c.success(function(b){return b.success&&(a.link.is_read=!0,a.$parent.markAsRead)?a.$parent.markAsRead(a.link):void 0})},a.markAsUnread=function(){var c;return c=b.post("/api/links/unread/"+a.link.id),c.success(function(b){return b.success?a.link.is_read=!1:void 0})},a["delete"]=function(){var c;return c=b.post("/api/links/delete/"+a.link.id),c.success(function(b){return b.success&&a.$parent.deleteItem?a.$parent.deleteItem(a.link):void 0})},a.save=function(){var c,d;return c=a.link,"New"===a.link.category&&(a.link.category=a.new_category),d=b.post("/api/links/save",$.param(c)),d.success(function(b){return b.success?(a.link_form.category.$dirty&&a.$parent.changeCategory&&a.$parent.changeCategory(a.link),a.link.category===a.new_category&&a.categories.push(a.new_category),a.editing=!1,a.$parent.linkAdded&&a.$parent.linkAdded(),alertify.success("Link "+(0===parseInt(a.link.id)?"added":"updated")+" successfully")):(a.errorMessage=b.error,a.$parent.saveError?a.$parent.saveError(b.error):void 0)}),d.error(function(){var b;return a.$emit("errorOccurred","Problem "+(null!=(b=a.link.id)?b:{updating:"adding"})+" link")})},a.cancelEdit=function(){return a.editing=!1,a.$parent.linkCancelled?a.$parent.linkCancelled():void 0},a.setCategories=function(b){return a.categories=b}}])}.call(this),function(){window.app.controller("MasterController",["$scope","$http","UserService",function(a,b,c){return a.initItems=0,a.$on("initStarted",function(){return a.init=!0,a.initItems++}),a.$on("initComplete",function(){return a.initItems--,0===a.initItems?a.init=!1:void 0}),a.$on("errorOccurred",function(b,c){return a.show_error=!0,a.error_message=c}),a.login=function(){var d,e;return a.init=!0,d={username:a.username,password:a.password},e=b.post("/api/login",$.param(d)),e.success(function(b){return a.init=!1,a.user=b.user,c.setUser(a.user),a.$broadcast("userLoggedIn")}),e.error(function(){return a.$emit("errorOccurred","Problem logging in")})},a.logout=function(){var d;return a.init=!0,d=b.post("/api/logout"),d.success(function(){return a.init=!1,a.user=null,c.setUser(a.user),a.$broadcast("userLoggedOut")}),d.error(function(){return a.$emit("errorOccurred","Problem logging out")})},a.initUser=function(b){return a.user=b,c.setUser(a.user)}}])}.call(this),function(){window.app.controller("MovieController",["$scope","$http",function(a,b){return a.getWidget=function(){var c;return c=b.get("/api/movies/widget"),c.success(function(b){return a.movies=b.movies})},a.changeRating=function(c,d){var e,f,g;return f=c.rating_order+d,e=a.movies.filter(function(a){return a.rating_order===f}),e[0].rating_order=c.rating_order,c.rating_order=f,g=b.post("/api/movies/save",$.param(c))}}])}.call(this),function(){window.app.controller("ReadLaterController",["$scope","$window","$timeout",function(a,b,c){return a.newLink=null,a.success=!1,a.editing=!0,a.error=!1,a.createLink=function(b,c,d){return a.newLink=new window.Link(b),a.newLink.name=c,a.newLink.link=d},a.linkAdded=function(){return a.success=!0,c(function(){return a.closeWindow()},1e3)},a.linkCancelled=function(){return a.closeWindow()},a.closeWindow=function(){return a.newLink=null,b.parent.postMessage("closeWindow","*")},a.saveError=function(b){return a.error=b,a.editing=!1}}])}.call(this),function(){window.app.controller("UserController",["$scope","$http",function(a,b){return a.$on("checkingAvailibility",function(){return a.submitting=!0}),a.$on("checkedAvailibility",function(){return a.submitting=!1}),a.registerUser=function(){var c,d;return c={first_name:a.first_name,last_name:a.last_name,email:a.email,username:a.username,password:a.password},a.submitting=!0,d=b.post("/api/register",$.param(c)),d.success(function(a){return console.log(a)}),d.error(function(){return a.$emit("errorOccurred","Problem with registration")})}}])}.call(this);